<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Ludo King Clone</title>
<style>
body { font-family: Arial, sans-serif; display:flex; flex-direction:column; align-items:center; background:#f6f6f6; margin:0; padding:0; }
h2 { margin:16px 0; }
#ludo-board { display:grid; grid-template-columns: repeat(15, 40px); grid-template-rows: repeat(15, 40px); gap:2px; background:#222; margin-bottom:16px; }
.cell { width:40px; height:40px; background:#eee; display:flex; align-items:center; justify-content:center; font-size:12px; position:relative; }
.cell.red { background:#ffcccc; }
.cell.green { background:#ccffcc; }
.cell.yellow { background:#ffffcc; }
.cell.blue { background:#cce5ff; }
.cell.safe { border:2px solid #333; }
.token { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white; cursor:pointer; position:absolute; top:5px; left:5px; transition:all 0.3s ease; }
.token.red { background:#c00; }
.token.green { background:#0a0; }
.token.yellow { background:#cc0; color:#222; }
.token.blue { background:#08f; }
#controls { display:flex; gap:8px; margin-bottom:16px; }
button { padding:8px 12px; font-size:14px; cursor:pointer; }
#dice { font-size:24px; width:40px; text-align:center; }
#players { display:flex; gap:12px; margin-bottom:16px; }
.player { padding:6px 12px; border-radius:6px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
.player.turn { border:2px solid #000; }
</style>
</head>
<body>

<h2>Web Ludo King Clone - Advanced</h2>

<div id="controls">
  <input id="name" placeholder="Your name">
  <button id="createBtn">Create Room</button>
  <input id="roomCode" placeholder="Room Code">
  <button id="joinBtn">Join Room</button>
  <button id="rollBtn" disabled>Roll Dice</button>
  <div id="dice">ðŸŽ²</div>
</div>

<div id="players"></div>

<div id="ludo-board"></div>

<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-database-compat.js"></script>
<script>
/************ FIREBASE CONFIG ************/
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/************ GAME VARIABLES ************/
const BOARD_SIZE = 15;
const boardEl = document.getElementById('ludo-board');
const diceEl = document.getElementById('dice');
const rollBtn = document.getElementById('rollBtn');
const playersDiv = document.getElementById('players');

let myId = 'p_' + Math.random().toString(36).substr(2,6);
let myName = '';
let myColor = null;
let roomCode = '';
let roomRef = null;
let roomData = null;

const cells = [];
const SAFE_CELLS = [2,8,13,27,32,38,42,47,52,57,62,67]; // example safe positions, you can adjust

/************ BOARD SETUP ************/
function createBoard() {
  boardEl.innerHTML = '';
  for (let i=0;i<BOARD_SIZE*BOARD_SIZE;i++){
    const c = document.createElement('div');
    c.className='cell';
    if (SAFE_CELLS.includes(i)) c.classList.add('safe');
    boardEl.appendChild(c);
    cells.push(c);
  }
  colorHomeZones();
}

function colorHomeZones() {
  for (let i=0;i<6;i++){
    for (let j=0;j<6;j++){
      cells[i*BOARD_SIZE+j].classList.add('red'); // top-left
      cells[i*BOARD_SIZE+BOARD_SIZE-6+j].classList.add('green'); // top-right
      cells[(BOARD_SIZE-6+i)*BOARD_SIZE+j].classList.add('yellow'); // bottom-left
      cells[(BOARD_SIZE-6+i)*BOARD_SIZE+BOARD_SIZE-6+j].classList.add('blue'); // bottom-right
    }
  }
}

createBoard();

/************ ROOM MANAGEMENT ************/
document.getElementById('createBtn').onclick = async () => {
  myName = document.getElementById('name').value || 'Player-'+myId;
  roomCode = Math.random().toString(36).substr(2,6).toUpperCase();
  roomRef = db.ref('rooms/'+roomCode);
  myColor = 0;
  const roomObj = { 
    players: { [myId]: { name: myName, color: myColor } }, 
    turn: 0, 
    dice:0, 
    started:false, 
    positions:{}, 
    finished:[]
  };
  await roomRef.set(roomObj);
  alert('Room created: '+roomCode);
  listenRoom();
}

document.getElementById('joinBtn').onclick = async () => {
  myName = document.getElementById('name').value || 'Player-'+myId;
  roomCode = document.getElementById('roomCode').value.toUpperCase();
  if (!roomCode) return alert('Enter room code');
  roomRef = db.ref('rooms/'+roomCode);
  const snap = await roomRef.once('value');
  if (!snap.exists()) return alert('Room not found');
  const room = snap.val();
  const colorsUsed = Object.values(room.players).map(p=>p.color);
  myColor = [0,1,2,3].find(c=>!colorsUsed.includes(c));
  room.players[myId] = { name: myName, color: myColor };
  await roomRef.child('players').set(room.players);
  listenRoom();
}

function listenRoom(){
  if (!roomRef) return;
  roomRef.on('value', snap => {
    roomData = snap.val();
    updatePlayersUI();
    updateBoardUI();
    updateRollButton();
  });
}

/************ UI UPDATES ************/
function updatePlayersUI(){
  playersDiv.innerHTML='';
  const pids = Object.keys(roomData.players);
  pids.forEach((pid,index)=>{
    const p=roomData.players[pid];
    const div=document.createElement('div');
    div.className='player'+(index===roomData.turn?' turn':'');
    div.textContent=p.name+(pid===myId?' (You)':'');
    playersDiv.appendChild(div);
  });
}

function updateBoardUI(){
  // Clear board
  cells.forEach(c=>c.innerHTML='');
  // Draw tokens
  Object.keys(roomData.positions||{}).forEach(pid=>{
    const posArr = roomData.positions[pid];
    const color = roomData.players[pid].color;
    posArr.forEach(pos=>{
      if(pos>=0 && pos<BOARD_SIZE*BOARD_SIZE){
        const t = document.createElement('div');
        t.className='token '+['red','green','yellow','blue'][color];
        t.textContent='â€¢';
        cells[pos].appendChild(t);
      }
    });
  });
}

/************ DICE & MOVE LOGIC ************/
rollBtn.onclick = async () => {
  if (!roomData) return;
  const order = Object.keys(roomData.players);
  if (order[roomData.turn]!==myId) return alert("Not your turn");
  
  // Dice animation
  let dice = 0;
  for(let i=0;i<10;i++){
    dice=Math.floor(Math.random()*6)+1;
    diceEl.textContent='ðŸŽ² '+dice;
    await new Promise(r=>setTimeout(r,50));
  }

  diceEl.textContent='ðŸŽ² '+dice;
  roomData.dice=dice;
  await roomRef.child('dice').set(dice);

  // Move first movable token
  const positions=roomData.positions[myId]||[-1,-1,-1,-1];
  let moved=false;
  if(dice===6){
    const idx=positions.findIndex(p=>p===-1);
    if(idx!==-1){ positions[idx]=0; moved=true; }
  }
  if(!moved){
    for(let i=0;i<4;i++){
      if(positions[i]>=0){
        positions[i]+=dice;
        if(positions[i]>=52) positions[i]=52; // finish
        moved=true;
        break;
      }
    }
  }
  roomData.positions[myId]=positions;
  await roomRef.child('positions').set(roomData.positions);

  // Check captures
  captureTokens(myId);

  // Check win
  checkWin(myId);

  // Next turn
  const nextIndex = dice===6 ? roomData.turn : (roomData.turn+1)%order.length;
  await roomRef.child('turn').set(nextIndex);
}

function captureTokens(pid){
  const myPos=roomData.positions[pid];
  Object.keys(roomData.positions||{}).forEach(other=>{
    if(other===pid) return;
    const otherPos=roomData.positions[other];
    for(let i=0;i<4;i++){
      if(myPos.includes(otherPos[i]) && !SAFE_CELLS.includes(otherPos[i])){
        otherPos[i]=-1; // send back to home
      }
    }
    roomData.positions[other]=otherPos;
  });
  roomRef.child('positions').set(roomData.positions);
}

function checkWin(pid){
  const pos=roomData.positions[pid];
  if(pos.every(p=>p===52) && !roomData.finished.includes(pid)){
    roomData.finished.push(pid);
    roomRef.child('finished').set(roomData.finished);
    alert(roomData.players[pid].name+' finished!');
  }
}

function updateRollButton(){
  const order = Object.keys(roomData.players);
  rollBtn.disabled = (order[roomData.turn]!==myId);
}

</script>
</body>
</html>
