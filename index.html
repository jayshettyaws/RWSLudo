<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web Ludo King Clone</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; background:#f6f7fb; }
  #app { max-width: 960px; padding: 12px; width: 100%; }
  header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  #board { display:grid; grid-template-columns: repeat(15, 40px); grid-template-rows: repeat(15, 40px); gap:2px; margin:12px 0; }
  .cell { width:40px; height:40px; display:flex; justify-content:center; align-items:center; font-size:12px; border:1px solid #ccc; position:relative; }
  .red { background:#ffcccc; } .green { background:#ccffcc; } .yellow { background:#fff4b2; } .blue { background:#cce6ff; }
  .safe { border:2px solid #000; }
  .token { width:28px; height:28px; border-radius:50%; position:absolute; cursor:pointer; display:flex; justify-content:center; align-items:center; color:#fff; font-size:14px; font-weight:bold; transition:all 0.3s ease; }
  .token0 { background:#ef4444; } .token1 { background:#16a34a; } .token2 { background:#f59e0b; } .token3 { background:#0ea5e9; }
  #controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
  input, button, select { padding:6px 10px; border-radius:6px; border:1px solid #ddd; font-size:14px; }
  button { cursor:pointer; background:#2563eb; color:white; border:0; }
  button.secondary { background:#efefef; color:#222; border:1px solid #ddd; }
  #dice { width:50px; height:50px; font-size:20px; text-align:center; line-height:50px; margin-left:12px; background:#fff; border:2px solid #ccc; border-radius:8px; display:inline-block; }
  #log { width:100%; max-height:200px; overflow:auto; background:#fff; padding:8px; border-radius:8px; margin-top:12px; }
  .small { font-size:13px; color:#666; }
</style>
</head>
<body>
<div id="app">
<header>
  <h2>Web Ludo King Clone</h2>
  <div class="small">Browser only | Free Multiplayer</div>
</header>

<div id="controls">
  <input id="displayName" placeholder="Your name (optional)">
  <button id="createBtn">Create Room</button>
  <input id="joinCode" placeholder="Enter Room Code">
  <button id="joinBtn" class="secondary">Join Room</button>
  <select id="colorPref">
    <option value="auto">Pick token color (auto)</option>
    <option value="0">Red</option>
    <option value="1">Green</option>
    <option value="2">Yellow</option>
    <option value="3">Blue</option>
  </select>
  <button id="startBtn" class="secondary" style="display:none;">Start Game (Host)</button>
  <button id="rollBtn" style="display:none;">Roll Dice</button>
  <div id="dice">ðŸŽ²</div>
</div>

<div><strong>Room:</strong> <span id="roomCodeLabel">â€”</span></div>
<div id="board"></div>
<div id="log"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCMqC5kNq0T_Q0MzryI6U59oCqVFI0z1c8",
  authDomain: "rwsludo.firebaseapp.com",
  databaseURL: "https://rwsludo-default-rtdb.firebaseio.com",
  projectId: "rwsludo",
  storageBucket: "rwsludo.appspot.com",
  messagingSenderId: "199418318279",
  appId: "1:199418318279:web:7ac803f55b081eba1b9de2"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const BOARD_SIZE = 15*15;
const boardEl = document.getElementById('board');
const logEl = document.getElementById('log');
const diceEl = document.getElementById('dice');

function appendLog(txt){ const d=document.createElement('div'); d.textContent=txt; logEl.appendChild(d); logEl.scrollTop=logEl.scrollHeight; }

// Generate simple board
const cells = [];
for(let r=0;r<15;r++){
  for(let c=0;c<15;c++){
    const cell = document.createElement('div');
    cell.className='cell';
    boardEl.appendChild(cell);
    cells.push(cell);
  }
}

// Minimal paths & home positions (simplified for demo)
const homePositions = {
  0: [0,1,15,16], // red home tokens
  1: [13,14,28,29], // green
  2: [210,211,225,226], // yellow
  3: [223,224,238,239] // blue
};
const pathPositions = []; // Define 52 path positions for each player (simplified)
for(let i=0;i<52;i++) pathPositions.push(i*3+10); // demo, linear spread

// Local session
let myId='p_'+Math.random().toString(36).slice(2,9);
let myName='', myColor=null, roomCode=null, roomRef=null, currentRoom=null, amHost=false;
let diceRoll=0;

// DOM refs
const createBtn = document.getElementById('createBtn'), joinBtn = document.getElementById('joinBtn'), startBtn = document.getElementById('startBtn'), rollBtn = document.getElementById('rollBtn');
const joinCodeInput = document.getElementById('joinCode'), displayNameInput = document.getElementById('displayName'), colorPref = document.getElementById('colorPref');
const roomCodeLabel = document.getElementById('roomCodeLabel');

// Room functions
function genRoomCode(){ return Math.random().toString(36).substring(2,8).toUpperCase(); }

async function createRoom(code){
  roomCode=code; roomRef=db.ref('rooms/'+roomCode);
  const players={}; players[myId]={name:myName,color:myColor||0,isHost:true,positions:[0,0,0,0]};
  const roomObj={players,createdAt:Date.now(),started:false};
  await roomRef.set(roomObj);
  listenRoom(); roomCodeLabel.innerText=roomCode;
  amHost=true; startBtn.style.display='inline-block';
  appendLog('Room created: '+roomCode);
}

async function joinRoom(code){
  roomCode=code; roomRef=db.ref('rooms/'+roomCode);
  const snap=await roomRef.once('value'); if(!snap.exists()){ alert('Room not found'); return;}
  const room=snap.val(); const players=room.players||{};
  if(Object.keys(players).length>=4){ alert('Room full'); return; }
  let chosen=myColor; if(chosen===null){ const used=new Set(Object.values(players).map(p=>p.color)); chosen=[0,1,2,3].find(c=>!used.has(c)); if(chosen===undefined)chosen=0;}
  players[myId]={name:myName,color:chosen,isHost:false,positions:[0,0,0,0]};
  await roomRef.child('players').set(players); listenRoom(); roomCodeLabel.innerText=roomCode;
  appendLog('Joined room: '+roomCode);
}

function listenRoom(){ if(!roomRef) return; roomRef.on('value',snap=>{ currentRoom=snap.val(); updateUI(); }); }

function updateUI(){
  boardEl.querySelectorAll('.token').forEach(t=>t.remove());
  if(!currentRoom) return;
  // Show players tokens
  Object.keys(currentRoom.players).forEach(pid=>{
    const player=currentRoom.players[pid];
    player.positions.forEach((pos,i)=>{
      if(pos>=0){
        const t=document.createElement('div'); t.className='token token'+player.color; t.title=player.name+' #'+(i+1);
        t.style.left='0px'; t.style.top='0px'; cells[pos].appendChild(t);
      }
    });
  });
  rollBtn.style.display=(currentRoom.started && currentRoom.players[currentRoom.order?.[currentRoom.turnIndex]]?.name===myName)?'inline-block':'none';
}

// Dice roll
rollBtn.onclick=async()=>{
  if(!currentRoom) return;
  diceRoll=Math.floor(Math.random()*6)+1;
  diceEl.textContent=diceRoll;
  // Move first movable token (demo)
  const player=currentRoom.players[myId];
  for(let i=0;i<4;i++){
    player.positions[i]+=diceRoll; if(player.positions[i]>=pathPositions.length) player.positions[i]=pathPositions.length-1; break;
  }
  await roomRef.child('players/'+myId+'/positions').set(player.positions);
}

// Buttons
createBtn.onclick=()=>{
  myName=displayNameInput.value.trim()||('Player-'+myId.slice(2,6));
  myColor=colorPref.value==='auto'?null:parseInt(colorPref.value); roomCode=genRoomCode(); createRoom(roomCode);
}
joinBtn.onclick=()=>{
  myName=displayNameInput.value.trim()||('Player-'+myId.slice(2,6));
  myColor=colorPref.value==='auto'?null:parseInt(colorPref.value); roomCode=joinCodeInput.value.trim().toUpperCase(); if(!roomCode){alert('Enter room code'); return;} joinRoom(roomCode);
}
startBtn.onclick=async()=>{
  if(!currentRoom) return;
  const players=Object.keys(currentRoom.players||{}); if(players.length<2){alert('Need 2+ players'); return;}
  const order=players.slice(0,4); await roomRef.update({started:true,order,turnIndex:0});
}
</script>
</body>
</html>
